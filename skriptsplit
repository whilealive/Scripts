#!/bin/bash
# ==================================================================
# FILE     skriptsplit
# MACHINE  all
# INFO     Split my school math theory script into chapters
#
# DATE     23.02.2022
# OWNER    Bischofberger
# ==================================================================

die() {
  echo -e "$0: Error: $1" >&2
  exit 1
}

# import chapter file
if [ -f "$1" ] ; then
  source "$1"
else
  die "missing or invalid argument"
fi

# check if variables are set in chapter file
if [ -z "${CHAPTERLIST+x}" ] || [ -z "${INPUTFILE+x}" ] ; then
  die "given file is corrupted"
fi

mkdir -p "$DESTFOLDER"

declare -n chapter
for chapter in "${CHAPTERLIST[@]}" ; do
  gs -sDEVICE=pdfwrite -dNOPAUSE -dBATCH -dSAFER \
     -dFirstPage=${chapter[1]} \
     -dLastPage=${chapter[2]} \
     -sOutputFile="${chapter[0]}" \
     "$INPUTFILE"
done

