#!/bin/bash
# ==================================================================
# FILE     backup
# MACHINE  all
# INFO     rsnapshot wrapper
#
# DATE     18.03.2018
# OWNER    Bischofberger
# ==================================================================

CONFIGS="$HOME/Scripts/data"
CONFIGFILE_LOCAL_QUICK="$CONFIGS/rsnapshot_local_quick.conf"
CONFIGFILE_LOCAL_FULL="$CONFIGS/rsnapshot_local_full.conf"
CONFIGFILE_BMZ="$CONFIGS/rsnapshot_bmz.conf"

die() {
  echo -e "$0: Error: $1" >&2
  exit 1
}

backitup() {
  sudo rsnapshot -c "$1" "$2"
}

privatebackup() {
  echo "Enter backup option:"
  echo -e "1\tquick\n2\tfull"
  read op
  case "$op" in
    "1")
      backitup "$CONFIGFILE_LOCAL_QUICK" "alpha" || return 1  # 0 = true, 1 = false
      ;;
    "2")
      backitup "$CONFIGFILE_LOCAL_FULL" "alpha" || return 1  # 0 = false, 1 = false
      ;;
    *)
      die "unknown parameter '$op'"
      ;;
  esac
}

bmzbackup() {
  cd "$HOME"
  mount webdav
  echo "Enter backup option:"
  echo -e "1\tweekly\n2\tmonthly\n3\tyearly"
  read level
  case "$level" in
    "1")
      backitup "$CONFIGFILE_BMZ" "weekly" || return 1  # 0 = true, 1 = false
      ;;
    "2")
      backitup "$CONFIGFILE_BMZ" "monthly" || return 1  # 0 = true, 1 = false
      ;;
    "3")
      backitup "$CONFIGFILE_BMZ" "yearly" || return 1  # 0 = true, 1 = false
      ;;
    *)
      die "unknown parameter '$level'"
      ;;
  esac
}


# main -----------------------------------
echo "Enter backup option:"
echo -e "1\tprivate\n2\tbmz"

read number

case "$number" in
  "1")
    privatebackup
    exit 0
    ;;
  "2")
    bmzbackup
    exit 0
    ;;
  *)
    die "unknown parameter '$number'"
    ;;
esac
